<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Gig - AtMyWorks</title>
    <meta name="description" content="Create a new gig/service listing on AtMyWorks to attract clients and grow your freelance business.">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <script src="js/firebase-config.js"></script>
</head>
<body data-page="create-gig">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/index.html" class="logo">AtMyWorks</a>
                <ul class="nav-links">
                    <li><a href="/browse.html">Find Work</a></li>
                    <li><a href="/blog.html">Blog</a></li>
                    <li><a href="#">How It Works</a></li>
                </ul>
                <div class="auth-buttons">
                    <button class="btn btn-outline" id="loginBtnNav">Log In</button>
                    <button class="btn btn-primary" id="signupBtnNav">Sign Up</button>
                </div>
                <div class="user-menu" id="userMenuNav" style="display: none; position: relative;">
                    <button class="btn btn-outline user-menu-toggle" id="userMenuToggleNav" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-bell" style="margin-right: 0.5rem;"></i>
                        <span class="user-avatar" id="userAvatarNav" style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-100), var(--secondary-100)); display: inline-flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary-800); margin-right: 0.5rem; box-shadow: var(--shadow-xs);">U</span>
                        <span id="userNameNav">User</span>
                        <i class="fas fa-chevron-down" style="margin-left: 0.5rem; font-size: var(--font-size-xs);"></i>
                    </button>

                    <!-- User Menu Dropdown -->
                    <div class="user-menu-dropdown" id="userMenuDropdownNav" style="display: none; position: absolute; top: 100%; right: 0; width: 250px; background: white; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-lg); padding: 1rem; z-index: 1000; margin-top: 0.5rem;">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                            <div class="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-100), var(--secondary-100)); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary-800); margin-right: 1rem; box-shadow: var(--shadow-xs);">U</div>
                            <div>
                                <div style="font-weight: var(--font-weight-semibold);" id="dropdownUserNameNav">User Name</div>
                                <div style="font-size: var(--font-size-sm); color: var(--gray-500);" id="dropdownUserEmailNav">user@example.com</div>
                            </div>
                        </div>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li style="margin-bottom: 0.5rem;"><a href="/profile.html" class="user-menu-link"><i class="fas fa-user-circle" style="margin-right: 0.75rem; width: 20px; text-align: center;"></i> My Profile</a></li>
                            <li style="margin-bottom: 0.5rem;"><a href="/messages.html" class="user-menu-link"><i class="fas fa-comments" style="margin-right: 0.75rem; width: 20px; text-align: center;"></i> Messages <span class="badge badge-primary" style="float: right;">3</span></a></li>
                            <li style="margin-bottom: 0.5rem;"><a href="/dashboard-client.html" class="user-menu-link" id="dashboardMenuLinkNav"><i class="fas fa-tachometer-alt" style="margin-right: 0.75rem; width: 20px; text-align: center;"></i> Dashboard</a></li>
                            <li style="margin-bottom: 0.5rem;"><a href="/settings.html" class="user-menu-link"><i class="fas fa-cog" style="margin-right: 0.75rem; width: 20px; text-align: center;"></i> Settings</a></li>
                            <li><button class="btn btn-outline btn-block logout-btn" id="logoutBtnInMenuNav" style="margin-top: 1rem;"><i class="fas fa-sign-out-alt" style="margin-right: 0.75rem;"></i> Logout</button></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- ========== CREATE GIG SECTION ========== -->
    <section class="section section-light">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <div style="background: white; border-radius: var(--border-radius-lg); padding: 2rem; box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                    <div class="dashboard-header">
                        <h1>Create New Service</h1>
                        <p>List your skills and attract clients</p>
                    </div>

                    <!-- Create Gig Form -->
                    <form id="createGigForm">
                        <div class="form-group">
                            <label for="gigTitle" class="form-label">Gig Title *</label>
                            <input type="text" id="gigTitle" name="title" class="form-control" placeholder="I will..." required>
                            <!-- AI Assistant Button for Gig Title will be added by JS -->
                            <div class="form-text">Briefly describe what you are offering.</div>
                        </div>

                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label for="gigCategory" class="form-label">Category *</label>
                                <select id="gigCategory" name="category" class="form-control" required>
                                    <option value="">Select Category</option>
                                    <option value="graphics-design">Graphics & Design</option>
                                    <option value="digital-marketing">Digital Marketing</option>
                                    <option value="programming-tech">Programming & Tech</option>
                                    <option value="video-animation">Video & Animation</option>
                                    <option value="writing-translation">Writing & Translation</option>
                                    <option value="music-audio">Music & Audio</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="gigDeliveryTime" class="form-label">Delivery Time (days) *</label>
                                <select id="gigDeliveryTime" name="deliveryTime" class="form-control" required>
                                    <option value="">Select Time</option>
                                    <option value="1">1 day</option>
                                    <option value="2">2 days</option>
                                    <option value="3">3 days</option>
                                    <option value="5">5 days</option>
                                    <option value="7">7 days</option>
                                    <option value="10">10 days</option>
                                    <option value="14">14 days</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="gigDescription" class="form-label">Description *</label>
                            <textarea id="gigDescription" name="description" rows="6" class="form-control" placeholder="Describe your service in detail..." required></textarea>
                            <!-- AI Assistant Button for Gig Description will be added by JS -->
                            <div class="form-text">Explain what you will do, the process, and what the buyer can expect.</div>
                        </div>

                        <!-- ========== GIG IMAGES UPLOAD ========== -->
                        <div class="form-group">
                            <label class="form-label">Gig Images *</label>
                            <div class="image-upload" id="imageUploadArea" style="
                                border: 2px dashed var(--border-color);
                                border-radius: var(--border-radius-lg);
                                padding: 2rem;
                                text-align: center;
                                cursor: pointer;
                                transition: border-color var(--transition-fast), background-color var(--transition-fast);
                                margin-bottom: 1rem;
                            ">
                                <i class="fas fa-cloud-upload-alt" style="
                                    font-size: 3rem;
                                    color: var(--gray-400);
                                    margin-bottom: 1rem;
                                "></i>
                                <p>Click to upload images</p>
                                <p style="
                                    font-size: var(--font-size-sm);
                                    color: var(--gray-400);
                                ">Recommended size: 800x600px (JPG, PNG, GIF)</p>
                                <input type="file" id="imageUpload" name="images" accept="image/*" multiple style="display: none;">
                            </div>
                            <div id="imagePreviewContainer" style="
                                display: flex;
                                flex-wrap: wrap;
                                gap: 1rem;
                                margin-top: 1rem;
                            ">
                                <!-- Image previews will be added here by JavaScript -->
                            </div>
                            <div class="form-text">Upload at least one image to showcase your service.</div>
                        </div>
                        <!-- ========== END GIG IMAGES UPLOAD ========== -->

                        <!-- ========== GIG VIDEO SHOWCASE UPLOAD ========== -->
                        <div class="form-group">
                            <label class="form-label">Gig Video Showcase (Optional)</label>
                            <div class="video-upload" id="videoUploadArea" style="
                                border: 2px dashed var(--border-color);
                                border-radius: var(--border-radius-lg);
                                padding: 2rem;
                                text-align: center;
                                cursor: pointer;
                                transition: border-color var(--transition-fast), background-color var(--transition-fast);
                                margin-bottom: 1rem;
                            ">
                                <i class="fas fa-video" style="
                                    font-size: 3rem;
                                    color: var(--gray-400);
                                    margin-bottom: 1rem;
                                "></i>
                                <p>Click to upload a video showcase</p>
                                <p style="
                                    font-size: var(--font-size-sm);
                                    color: var(--gray-400);
                                ">Recommended format: MP4, MOV, AVI (Max 100MB)</p>
                                <input type="file" id="videoUpload" name="videos" accept="video/*" style="display: none;">
                            </div>
                            <div id="videoPreviewContainer" style="
                                display: none;
                                margin-top: 1rem;
                                padding: 1rem;
                                border-radius: var(--border-radius-md);
                                background: var(--gray-50);
                                border: 1px solid var(--border-color);
                            ">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h4 style="margin: 0;">Video Preview</h4>
                                    <button type="button" class="btn btn-outline btn-sm" id="removeVideoBtn" style="padding: 0.25rem 0.5rem;">
                                        <i class="fas fa-times"></i> Remove
                                    </button>
                                </div>
                                <video id="gigVideoPreview" controls style="
                                    width: 100%;
                                    max-height: 300px;
                                    border-radius: var(--border-radius-md);
                                ">
                                    Your browser does not support the video tag.
                                </video>
                                <div style="margin-top: 1rem; font-size: var(--font-size-sm); color: var(--gray-500);">
                                    <p><strong>File Name:</strong> <span id="videoFileName">-</span></p>
                                    <p><strong>File Size:</strong> <span id="videoFileSize">-</span></p>
                                </div>
                            </div>
                            <div class="form-text">Upload a short video (30-60 seconds) showcasing your service in action.</div>
                        </div>
                        <!-- ========== END GIG VIDEO SHOWCASE UPLOAD ========== -->

                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label for="gigPrice" class="form-label">Starting Price ($) *</label>
                                <input type="number" id="gigPrice" name="price" min="5" step="5" class="form-control" placeholder="20" required>
                            </div>

                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem;">Create Gig</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <!-- ========== END CREATE GIG SECTION ========== -->

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>AtMyWorks</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Press</a></li>
                        <li><a href="/blog.html">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Help & Support</a></li>
                        <li><a href="#">Trust & Safety</a></li>
                        <li><a href="#">Selling on AtMyWorks</a></li>
                        <li><a href="#">Buying on AtMyWorks</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                        <li><a href="#">Copyright Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 AtMyWorks. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Files -->
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log("Create Gig Page DOM loaded");

            // Check if firebaseApp is available (from firebase-config.js)
            if (typeof window.firebaseApp !== 'undefined') {
                window.auth = window.firebaseApp.auth;
                window.db = window.firebaseApp.db;
                window.storage = window.firebaseApp.storage;
                console.log("Firebase services available in create-gig.html");
            } else {
                console.warn("Firebase not initialized in create-gig.html.");
                alert("Unable to connect to the database. Please try refreshing the page.");
                return;
            }

            // --- GIG CREATION LOGIC ---
            window.GigCreationSystem = {
                currentUser: null,
                currentUserId: null,

                /**
                 * Initializes the gig creation system.
                 * Sets up auth state listener and loads initial form data.
                 */
                async init() {
                    console.log("Initializing Gig Creation System...");

                    // Listen for auth state changes (login/logout)
                    window.auth.onAuthStateChanged(user => {
                        if (user) {
                            this.currentUser = user;
                            this.currentUserId = user.uid;
                            console.log("User logged in for gig creation:", user.uid, user.email);
                            // Load form data if needed
                            // this.loadGigCreationFormData();
                        } else {
                            this.currentUser = null;
                            this.currentUserId = null;
                            console.log("User logged out from gig creation system");
                            // Hide form or show an error
                            // window.location.href = '/login.html'; // Redirect to login
                        }
                    });
                },

                /**
                 * Loads gig creation form data from Firestore.
                 * This could include user's existing gigs, categories, etc.
                 */
                async loadGigCreationFormData() {
                    if (!this.currentUser || !this.currentUserId) {
                        console.warn("No user logged in, cannot load gig creation form data.");
                        return;
                    }

                    try {
                        console.log(`Loading gig creation form data for user: ${this.currentUserId}`);
                        // Query Firestore for user's existing gigs, categories, etc.
                        // For now, we'll just simulate loading
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay
                        console.log("Gig creation form data loaded successfully");
                    } catch (error) {
                        console.error("Error loading gig creation form data:", error);
                        alert('Failed to load form data. Please try again.');
                    }
                },

                /**
                 * Handles gig creation form submission.
                 * @param {Event} event - The form submission event.
                 */
                async handleGigCreationFormSubmit(event) {
                    event.preventDefault();
                    console.log("Gig creation form submitted");

                    const user = this.currentUser;
                    if (!user) {
                        alert('You must be logged in to create a gig.');
                        window.location.href = '/login.html';
                        return;
                    }

                    const form = event.target;
                    const formData = new FormData(form);

                    // --- CRITICAL: ADAPT FIELD NAMES TO YOUR ACTUAL FORM INPUT NAMES ---
                    const title = formData.get('title')?.trim();
                    const category = formData.get('category');
                    const deliveryTime = parseInt(formData.get('deliveryTime'));
                    const description = formData.get('description')?.trim();
                    const price = parseFloat(formData.get('price'));
                    const imageFiles = formData.getAll('images'); // Get all selected image files
                    const videoFile = formData.get('videos'); // Get the selected video file

                    // --- BASIC VALIDATION ---
                    if (!title || !category || !deliveryTime || !description || isNaN(price) || price <= 0) {
                        alert("Please fill in all required fields correctly.");
                        return;
                    }

                    if (!imageFiles || imageFiles.length === 0) {
                        alert("Please upload at least one image.");
                        return;
                    }

                    // Validate image files
                    for (const file of imageFiles) {
                        if (file && file.size > 0) {
                            // Validate file type
                            const allowedImageTypes = ['image/jpeg', 'image/png', 'image/gif'];
                            if (!allowedImageTypes.includes(file.type)) {
                                alert(`Invalid image file type: ${file.name}. Please upload JPG, PNG, or GIF images.`);
                                return;
                            }

                            // Validate file size (e.g., 5MB max per image)
                            const maxImageSize = 5 * 1024 * 1024; // 5MB in bytes
                            if (file.size > maxImageSize) {
                                alert(`Image file size exceeds 5MB limit: ${file.name}. Please select a smaller image.`);
                                return;
                            }
                        }
                    }

                    // Validate video file (if uploaded)
                    if (videoFile && videoFile.size > 0) {
                        // Validate file type
                        const allowedVideoTypes = ['video/mp4', 'video/mov', 'video/avi', 'video/webm'];
                        if (!allowedVideoTypes.includes(videoFile.type)) {
                            alert(`Invalid video file type: ${videoFile.name}. Please upload MP4, MOV, AVI, or WebM videos.`);
                            return;
                        }

                        // Validate file size (e.g., 100MB max)
                        const maxVideoSize = 100 * 1024 * 1024; // 100MB in bytes
                        if (videoFile.size > maxVideoSize) {
                            alert(`Video file size exceeds 100MB limit: ${videoFile.name}. Please select a smaller video.`);
                            return;
                        }
                    }

                    const gigData = {
                        title: title,
                        category: category,
                        deliveryTime: deliveryTime,
                        description: description,
                        startingPrice: price,
                        freelancerId: user.uid,
                        freelancerName: user.displayName || user.email?.split('@')[0] || 'Freelancer',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'active' // Default status
                    };

                    console.log("Prepared gig data for creation:", gigData);

                    // --- HANDLE SUBMISSION UI ---
                    const submitButton = form.querySelector('button[type="submit"]');
                    const originalContent = submitButton ? submitButton.innerHTML : '';
                    if (submitButton) {
                        submitButton.disabled = true;
                        submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Creating Gig...';
                    }

                    try {
                        // --- UPLOAD IMAGES TO FIREBASE STORAGE ---
                        const imageUrls = [];
                        if (imageFiles && imageFiles.length > 0) {
                            for (const file of imageFiles) {
                                if (file && file.size > 0) {
                                    // Create a unique path for each image
                                    const imagePath = `gigs/${user.uid}/${Date.now()}_${file.name}`;
                                    console.log("Uploading image to path:", imagePath);

                                    // Upload image and get download URL
                                    const downloadURL = await this.uploadFileToStorage(file, imagePath);
                                    imageUrls.push(downloadURL);
                                    console.log("Image uploaded successfully:", downloadURL);
                                }
                            }
                        }
                        gigData.imageUrls = imageUrls;
                        // --- END IMAGE UPLOAD ---

                        // --- UPLOAD VIDEO TO FIREBASE STORAGE (if provided) ---
                        if (videoFile && videoFile.size > 0) {
                            // Create a unique path for the video
                            const videoPath = `gigs/${user.uid}/${Date.now()}_${videoFile.name}`;
                            console.log("Uploading video to path:", videoPath);

                            // Upload video and get download URL
                            const videoDownloadURL = await this.uploadFileToStorage(videoFile, videoPath);
                            gigData.videoUrl = videoDownloadURL;
                            console.log("Video uploaded successfully:", videoDownloadURL);
                        }
                        // --- END VIDEO UPLOAD ---

                        // --- SAVE GIG DATA TO FIRESTORE ---
                        const docRef = await window.db.collection('gigs').add(gigData);
                        console.log("Gig created successfully with ID:", docRef.id);
                        // --- END GIG SAVE ---

                        // Show success message
                        alert('Gig created successfully!');

                        // Redirect to freelancer dashboard or the new gig page
                        window.location.href = '/dashboard-freelancer.html'; // Or /gig-detail.html?id=GIG_ID_HERE

                    } catch (error) {
                        // Re-enable button on error
                        if (submitButton) {
                            submitButton.disabled = false;
                            submitButton.innerHTML = originalContent || 'Create Gig';
                        }
                        // Error message already shown in uploadFileToStorage or Firestore save
                        console.error("Gig creation failed:", error);
                    }
                },

                /**
                 * Uploads a file to Firebase Storage.
                 * @param {File} file - The file object to upload.
                 * @param {string} path - The path in Firebase Storage where the file should be uploaded.
                 * @returns {Promise<string>} The download URL of the uploaded file.
                 */
                async uploadFileToStorage(file, path) {
                    console.log("Uploading file to Firebase Storage...");
                    console.log("File:", file.name, file.size, file.type);
                    console.log("Path:", path);

                    // Validate inputs
                    if (!file || !path) {
                        throw new Error("File and path are required for upload.");
                    }

                    const user = this.currentUser;
                    if (!user) {
                        throw new Error("User must be logged in to upload files.");
                    }

                    try {
                        // Create a reference to the file in Firebase Storage
                        const storageRef = window.storage.ref();
                        const fileRef = storageRef.child(path);

                        // Upload the file
                        const snapshot = await fileRef.put(file);
                        console.log("File uploaded successfully to Storage:", snapshot.ref.fullPath);

                        // Get the download URL
                        const downloadURL = await snapshot.ref.getDownloadURL();
                        console.log("Download URL retrieved:", downloadURL);
                        return downloadURL;

                    } catch (error) {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.error("Storage upload error:", errorCode, errorMessage);

                        // Provide user-friendly error messages
                        let userMessage = `File upload failed: ${errorMessage}`;
                        if (errorCode === 'storage/unauthorized') {
                            userMessage = "You don't have permission to upload files. Please contact support.";
                        } else if (errorCode === 'storage/canceled') {
                            userMessage = "File upload was canceled.";
                        } else if (errorCode === 'storage/unknown') {
                             userMessage = "Unknown error occurred during file upload. Please try again.";
                        }
                        alert(userMessage);
                        throw error; // Re-throw for caller
                    }
                }
            };

            // Initialize the gig creation system
            window.GigCreationSystem.init();

            // --- ATTACH EVENT LISTENERS ---
            // Handle gig creation form submission
            const createGigForm = document.getElementById('createGigForm');
            if (createGigForm) {
                console.log("Found create gig form, attaching submit listener");
                createGigForm.addEventListener('submit', window.GigCreationSystem.handleGigCreationFormSubmit.bind(window.GigCreationSystem));
            } else {
                console.log("Create gig form not found on this page");
            }

            // Handle image upload area click
            const imageUploadArea = document.getElementById('imageUploadArea');
            const imageUploadInput = document.getElementById('imageUpload');
            if (imageUploadArea && imageUploadInput) {
                console.log("Found image upload area and input, attaching click listener");
                imageUploadArea.addEventListener('click', function() {
                    imageUploadInput.click();
                });

                imageUploadInput.addEventListener('change', function(e) {
                    const files = e.target.files;
                    if (files) {
                        console.log("Image files selected:", files.length);
                        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
                        if (imagePreviewContainer) {
                            imagePreviewContainer.innerHTML = ''; // Clear previous previews
                            for (let i = 0; i < files.length; i++) {
                                const file = files[i];
                                if (file && file.type.startsWith('image/')) {
                                    const reader = new FileReader();
                                    reader.onload = function(event) {
                                        const imgContainer = document.createElement('div');
                                        imgContainer.style.position = 'relative';
                                        imgContainer.style.width = '100px';
                                        imgContainer.style.height = '100px';

                                        const img = document.createElement('img');
                                        img.src = event.target.result;
                                        img.alt = file.name;
                                        img.style.width = '100%';
                                        img.style.height = '100%';
                                        img.style.objectFit = 'cover';
                                        img.style.borderRadius = 'var(--border-radius-md)';
                                        img.style.boxShadow = 'var(--shadow-xs)';

                                        imgContainer.appendChild(img);
                                        imagePreviewContainer.appendChild(imgContainer);
                                    };
                                    reader.readAsDataURL(file);
                                }
                            }
                        }
                    }
                });
            } else {
                console.log("Image upload area or input not found on create-gig.html");
            }

            // Handle video upload area click
            const videoUploadArea = document.getElementById('videoUploadArea');
            const videoUploadInput = document.getElementById('videoUpload');
            const videoPreviewContainer = document.getElementById('videoPreviewContainer');
            const gigVideoPreview = document.getElementById('gigVideoPreview');
            const videoFileName = document.getElementById('videoFileName');
            const videoFileSize = document.getElementById('videoFileSize');
            const removeVideoBtn = document.getElementById('removeVideoBtn');

            if (videoUploadArea && videoUploadInput) {
                console.log("Found video upload area and input, attaching click listener");
                videoUploadArea.addEventListener('click', function() {
                    videoUploadInput.click();
                });

                videoUploadInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        console.log("Video file selected:", file.name);
                        // Validate file type
                        const allowedTypes = ['video/mp4', 'video/mov', 'video/avi', 'video/webm'];
                        if (!allowedTypes.includes(file.type)) {
                            alert(`Invalid video file type: ${file.name}. Please upload MP4, MOV, AVI, or WebM videos.`);
                            return;
                        }

                        // Validate file size (e.g., 100MB max)
                        const maxSize = 100 * 1024 * 1024; // 100MB in bytes
                        if (file.size > maxSize) {
                            alert(`Video file size exceeds 100MB limit: ${file.name}. Please select a smaller video.`);
                            return;
                        }

                        if (videoPreviewContainer && gigVideoPreview) {
                            // Show video preview container
                            videoPreviewContainer.style.display = 'block';

                            // Set video source
                            const videoUrl = URL.createObjectURL(file);
                            gigVideoPreview.src = videoUrl;

                            // Update file info
                            if (videoFileName) videoFileName.textContent = file.name;
                            if (videoFileSize) videoFileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(2)} MB`;

                            // Handle video load/error
                            gigVideoPreview.addEventListener('loadeddata', function() {
                                console.log("Video preview loaded successfully");
                                URL.revokeObjectURL(videoUrl); // Release object URL
                            });

                            gigVideoPreview.addEventListener('error', function() {
                                console.error("Error loading video preview");
                                alert("Error loading video preview. Please try again.");
                                URL.revokeObjectURL(videoUrl); // Release object URL
                            });
                        }
                    }
                });
            } else {
                console.log("Video upload area or input not found on create-gig.html");
            }

            // Handle remove video button click
            if (removeVideoBtn && videoUploadInput && videoPreviewContainer) {
                console.log("Found remove video button, attaching click listener");
                removeVideoBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log("Remove video button clicked");

                    // Clear video input
                    videoUploadInput.value = '';

                    // Hide video preview container
                    videoPreviewContainer.style.display = 'none';

                    // Clear video source and info
                    if (gigVideoPreview) gigVideoPreview.src = '';
                    if (videoFileName) videoFileName.textContent = '-';
                    if (videoFileSize) videoFileSize.textContent = '-';

                    console.log("Video removed from form");
                });
            } else {
                console.log("Remove video button or related elements not found on create-gig.html");
            }
            // --- END EVENT LISTENERS ---
        });
    </script>
</body>
</html>