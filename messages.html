<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages - AtMyWorks</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <script src="js/firebase-config.js"></script>
</head>
<body data-page="messages">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/index.html" class="logo">AtMyWorks</a>
                <ul class="nav-links">
                    <li><a href="/browse.html">Find Work</a></li>
                    <li><a href="/blog.html">Blog</a></li>
                    <li><a href="#">How It Works</a></li>
                </ul>
                <div class="auth-buttons">
                    <button class="btn btn-outline" id="loginBtn">Log In</button>
                    <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Messages Content -->
    <main class="messages" style="padding: 2rem 0;">
        <div class="container">
            <div class="dashboard-header">
                <h1>Messages & Notifications</h1>
                <p>Communicate with clients, freelancers, and stay updated with platform news</p>
            </div>

            <!-- Main Content Grid -->
            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem; margin-top: 2rem;">
                <!-- Sidebar Navigation -->
                <aside style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); height: fit-content;">
                    <h3 style="margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-color);">Messaging</h3>
                    <nav>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="messages-nav-link active" data-section="inbox"><i class="fas fa-inbox"></i> Inbox</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="messages-nav-link" data-section="sent"><i class="fas fa-paper-plane"></i> Sent</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="messages-nav-link" data-section="archive"><i class="fas fa-archive"></i> Archived</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="messages-nav-link" data-section="notifications"><i class="fas fa-bell"></i> Notifications</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="messages-nav-link" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li>
                        </ul>
                    </nav>
                </aside>

                <!-- Main Content Area -->
                <section id="messagesMainContent">
                    <!-- Inbox Section (Default) -->
                    <div id="inbox" class="messages-section active">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2>Inbox</h2>
                            <div>
                                <input type="text" id="inboxSearch" class="form-control" placeholder="Search messages..." style="width: 200px; margin-right: 1rem;">
                                <button class="btn btn-outline"><i class="fas fa-search"></i></button>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem;">
                            <!-- Conversations List -->
                            <div style="background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-md);">
                                <h3 style="margin-bottom: 1rem;">Conversations</h3>
                                <ul id="conversationsList" style="list-style: none; padding: 0;">
                                    <li style="padding: 0.5rem; border-bottom: 1px solid var(--border-color); cursor: pointer; text-align: center; color: var(--gray-500);">Loading conversations...</li>
                                </ul>
                            </div>

                            <!-- Chat Window -->
                            <div style="background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-md); display: flex; flex-direction: column;">
                                <div id="chatHeader" style="padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); margin-bottom: 1rem;">
                                    <h3 id="chatWithUserName">Select a conversation</h3>
                                </div>
                                <div id="chatMessages" style="flex-grow: 1; overflow-y: auto; padding: 1rem; background: var(--gray-50); border-radius: 0.5rem; margin-bottom: 1rem; height: 400px;">
                                    <p style="text-align: center; color: var(--gray-500);">Select a conversation to start chatting.</p>
                                </div>
                                <div id="chatInputArea" style="display: none;">
                                    <textarea id="chatMessageInput" class="form-control" placeholder="Type your message..." rows="3" style="margin-bottom: 0.5rem;"></textarea>
                                    <button class="btn btn-primary" style="width: 100%;"><i class="fas fa-paper-plane"></i> Send Message</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sent Section -->
                    <div id="sent" class="messages-section" style="display: none;">
                        <h2>Sent Messages</h2>
                        <p>This section will display messages you have sent.</p>
                        <!-- Placeholder for sent messages -->
                    </div>

                    <!-- Archive Section -->
                    <div id="archive" class="messages-section" style="display: none;">
                        <h2>Archived Messages</h2>
                        <p>This section will display archived conversations.</p>
                        <!-- Placeholder for archived messages -->
                    </div>

                    <!-- Notifications Section -->
                    <div id="notifications" class="messages-section" style="display: none;">
                        <h2>Notifications</h2>
                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem;">Platform Notifications</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 1rem 0; border-bottom: 1px solid var(--border-color);">
                                    <div style="display: flex; align-items: flex-start;">
                                        <i class="fas fa-info-circle" style="font-size: 1.5rem; color: var(--primary-500); margin-right: 1rem; flex-shrink: 0;"></i>
                                        <div>
                                            <h4 style="margin-bottom: 0.5rem;">New Feature: Advanced Search</h4>
                                            <p style="margin-bottom: 0.5rem; color: var(--gray-600);">We've added advanced search filters to help you find the perfect services faster.</p>
                                            <div style="font-size: var(--font-size-sm); color: var(--gray-500);">2 hours ago</div>
                                        </div>
                                    </div>
                                </li>
                                <li style="padding: 1rem 0; border-bottom: 1px solid var(--border-color);">
                                    <div style="display: flex; align-items: flex-start;">
                                        <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: var(--warning-500); margin-right: 1rem; flex-shrink: 0;"></i>
                                        <div>
                                            <h4 style="margin-bottom: 0.5rem;">Maintenance Scheduled</h4>
                                            <p style="margin-bottom: 0.5rem; color: var(--gray-600);">Scheduled maintenance will occur on Sunday, June 18th from 2:00 AM to 4:00 AM UTC. Some features may be temporarily unavailable.</p>
                                            <div style="font-size: var(--font-size-sm); color: var(--gray-500);">1 day ago</div>
                                        </div>
                                    </div>
                                </li>
                                <li style="padding: 1rem 0;">
                                    <div style="display: flex; align-items: flex-start;">
                                        <i class="fas fa-check-circle" style="font-size: 1.5rem; color: var(--success-500); margin-right: 1rem; flex-shrink: 0;"></i>
                                        <div>
                                            <h4 style="margin-bottom: 0.5rem;">Payment Received</h4>
                                            <p style="margin-bottom: 0.5rem; color: var(--gray-600);">You have received a payment of $150 for your logo design service.</p>
                                            <div style="font-size: var(--font-size-sm); color: var(--gray-500);">3 days ago</div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md);">
                            <h3 style="margin-bottom: 1rem;">Job Notifications</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 1rem 0; border-bottom: 1px solid var(--border-color);">
                                    <div style="display: flex; align-items: flex-start;">
                                        <i class="fas fa-briefcase" style="font-size: 1.5rem; color: var(--primary-500); margin-right: 1rem; flex-shrink: 0;"></i>
                                        <div>
                                            <h4 style="margin-bottom: 0.5rem;">New Job Posted: Web Developer Needed</h4>
                                            <p style="margin-bottom: 0.5rem; color: var(--gray-600);">A new job matching your skills has been posted. Check it out now!</p>
                                            <div style="font-size: var(--font-size-sm); color: var(--gray-500);">5 hours ago</div>
                                        </div>
                                    </div>
                                </li>
                                <li style="padding: 1rem 0;">
                                    <div style="display: flex; align-items: flex-start;">
                                        <i class="fas fa-user-plus" style="font-size: 1.5rem; color: var(--success-500); margin-right: 1rem; flex-shrink: 0;"></i>
                                        <div>
                                            <h4 style="margin-bottom: 0.5rem;">New Applicant for Your Job</h4>
                                            <p style="margin-bottom: 0.5rem; color: var(--gray-600);">John Doe has applied for your 'Logo Design' job post. Review their application now.</p>
                                            <div style="font-size: var(--font-size-sm); color: var(--gray-500);">1 week ago</div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div id="settings" class="messages-section" style="display: none;">
                        <h2>Message Settings</h2>
                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem;">Notification Preferences</h3>
                            <form id="notificationPreferencesForm">
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="emailNotifications" class="form-check-input" checked>
                                    <label for="emailNotifications" class="form-check-label">Receive email notifications for new messages</label>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="pushNotifications" class="form-check-input" checked>
                                    <label for="pushNotifications" class="form-check-label">Receive push notifications for new messages</label>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="smsNotifications" class="form-check-input">
                                    <label for="smsNotifications" class="form-check-label">Receive SMS notifications for urgent messages</label>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Preferences</button>
                            </form>
                        </div>

                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md);">
                            <h3 style="margin-bottom: 1rem;">Privacy Settings</h3>
                            <form id="privacySettingsForm">
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="allowMessagesFromAnyone" class="form-check-input" checked>
                                    <label for="allowMessagesFromAnyone" class="form-check-label">Allow messages from anyone</label>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="requireApprovalForNewContacts" class="form-check-input">
                                    <label for="requireApprovalForNewContacts" class="form-check-label">Require approval before new contacts can message you</label>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>AtMyWorks</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Press</a></li>
                        <li><a href="/blog.html">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Help & Support</a></li>
                        <li><a href="#">Trust & Safety</a></li>
                        <li><a href="#">Selling on AtMyWorks</a></li>
                        <li><a href="#">Buying on AtMyWorks</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                        <li><a href="#">Copyright Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 AtMyWorks. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Files -->
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/messages.js"></script> <!-- Dedicated messages JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log("Messages Page DOM loaded");

            // Check if firebaseApp is available (from firebase-config.js)
            if (typeof window.firebaseApp !== 'undefined') {
                window.auth = window.firebaseApp.auth;
                window.db = window.firebaseApp.db;
                window.storage = window.firebaseApp.storage;
                console.log("Firebase services available in messages.html");
            } else {
                console.warn("Firebase not initialized in messages.html.");
                alert("Unable to connect to the database. Please try refreshing the page.");
                return;
            }

            // --- MESSAGES NAVIGATION LOGIC ---
            const navLinks = document.querySelectorAll('.messages-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetSectionId = this.getAttribute('data-section');
                    switchSection(targetSectionId);
                });
            });

            // --- TAB SWITCHING LOGIC ---
            function switchSection(sectionId) {
                console.log("Switching to messages section:", sectionId);
                // Hide all sections
                const sections = document.querySelectorAll('.messages-section');
                sections.forEach(section => {
                    section.style.display = 'none';
                    section.classList.remove('active');
                });

                // Show the target section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    targetSection.classList.add('active');
                }

                // Update active nav link
                const navLinks = document.querySelectorAll('.messages-nav-link');
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-section') === sectionId) {
                        link.classList.add('active');
                    }
                });

                // Load data for the section if needed
                if (typeof window.loadMessagesSectionData === 'function') {
                    window.loadMessagesSectionData(sectionId);
                } else {
                    console.warn(`loadMessagesSectionData function not found for section ${sectionId}`);
                }
            }

            // --- FORM SUBMISSIONS ---
            // Notification Preferences Form
            const notificationPreferencesForm = document.getElementById('notificationPreferencesForm');
            if (notificationPreferencesForm) {
                notificationPreferencesForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Notification preferences form submitted");
                    alert("Notification preferences saving logic would be implemented here.");
                    // In a real app, you would collect form data and save it to Firestore
                    // or update user settings in your backend.
                });
            }

            // Privacy Settings Form
            const privacySettingsForm = document.getElementById('privacySettingsForm');
            if (privacySettingsForm) {
                privacySettingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Privacy settings form submitted");
                    alert("Privacy settings saving logic would be implemented here.");
                    // In a real app, you would collect form data and save it to Firestore
                    // or update user settings in your backend.
                });
            }
            // --- END FORM SUBMISSIONS ---
        });
    </script>
</body>
</html>