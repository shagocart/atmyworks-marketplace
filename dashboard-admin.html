<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AtMyWorks</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css"> <!-- Quill CSS for rich text editor -->

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <script src="js/firebase-config.js"></script>
</head>
<body data-page="dashboard-admin">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/index.html" class="logo">AtMyWorks</a>
                <ul class="nav-links">
                    <li><a href="/browse.html">Find Work</a></li>
                    <li><a href="/blog.html">Blog</a></li>
                    <li><a href="#">How It Works</a></li>
                </ul>
                <div class="auth-buttons">
                    <button class="btn btn-outline logout-btn">Logout</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Dashboard Content -->
    <main class="dashboard" style="padding: 2rem 0;">
        <div class="container">
            <div class="dashboard-header">
                <h1>Administrator Dashboard</h1>
                <p>Manage your platform settings and users</p>
            </div>

            <!-- Stats Overview -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-card-value" id="totalUsersCount">0</div>
                    <div class="stat-card-label">Total Users</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-icon">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="stat-card-value" id="totalGigsCount">0</div>
                    <div class="stat-card-label">Total Services</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-card-value" id="totalOrdersCount">0</div>
                    <div class="stat-card-label">Total Orders</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-card-value" id="totalRevenueAmount">$0</div>
                    <div class="stat-card-label">Platform Revenue</div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div style="display: grid; grid-template-columns: 250px 1fr; gap: 2rem; margin-top: 2rem;">
                <!-- Sidebar Navigation -->
                <aside style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); height: fit-content;">
                    <h3 style="margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-color);">Admin Menu</h3>
                    <nav>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link active" data-section="overview"><i class="fas fa-tachometer-alt"></i> Overview</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="users"><i class="fas fa-users-cog"></i> Manage Users</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="kyc"><i class="fas fa-id-card"></i> KYC Verifications</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="categories"><i class="fas fa-tags"></i> Manage Categories</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="gigs"><i class="fas fa-briefcase"></i> Manage Services</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="orders"><i class="fas fa-shopping-cart"></i> Manage Orders</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="withdrawals"><i class="fas fa-money-bill-transfer"></i> Withdrawal Requests</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="blog"><i class="fas fa-blog"></i> Manage Blog</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="messages"><i class="fas fa-comments"></i> Live Messages</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="notifications"><i class="fas fa-bell"></i> Send Notifications</a></li>
                            <li style="margin-bottom: 0.75rem;"><a href="#" class="admin-nav-link" data-section="settings"><i class="fas fa-cog"></i> Platform Settings</a></li>
                        </ul>
                    </nav>
                </aside>

                <!-- Main Content Area -->
                <section id="adminMainContent">
                    <!-- Overview Section (Default) -->
                    <div id="overview" class="admin-section active">
                        <h2 style="margin-bottom: 1.5rem;">Dashboard Overview</h2>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-user-clock"></i>
                                </div>
                                <div class="stat-card-value" id="pendingKycCount">0</div>
                                <div class="stat-card-label">Pending KYC</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                </div>
                                <div class="stat-card-value" id="pendingWithdrawalsCount">0</div>
                                <div class="stat-card-label">Pending Withdrawals</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-ticket-alt"></i>
                                </div>
                                <div class="stat-card-value" id="openTicketsCount">0</div>
                                <div class="stat-card-label">Open Support Tickets</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-icon">
                                    <i class="fas fa-comment-medical"></i>
                                </div>
                                <div class="stat-card-value" id="unreadMessagesCount">0</div>
                                <div class="stat-card-label">Unread Messages</div>
                            </div>
                        </div>

                        <div style="margin-top: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md);">
                                <h3 style="margin-bottom: 1rem;">Recent Activity</h3>
                                <ul id="recentActivityList" style="list-style: none; padding: 0;">
                                    <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">Loading recent activity...</li>
                                </ul>
                            </div>
                            <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md);">
                                <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <button class="btn btn-primary" onclick="switchSection('users')"><i class="fas fa-users"></i> View Users</button>
                                    <button class="btn btn-outline" onclick="switchSection('kyc')"><i class="fas fa-id-card"></i> KYC Queue</button>
                                    <button class="btn btn-outline" onclick="switchSection('withdrawals')"><i class="fas fa-money-bill-transfer"></i> Withdrawals</button>
                                    <button class="btn btn-outline" onclick="switchSection('blog')"><i class="fas fa-blog"></i> New Blog Post</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Users Section -->
                    <div id="users" class="admin-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2>Manage Users</h2>
                            <button class="btn btn-primary" onclick="openUserModal('create')"><i class="fas fa-plus"></i> Add New User</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Name/Company</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr><td colspan="7" style="text-align: center;">Loading users...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Pagination -->
                        <div style="display: flex; justify-content: center; margin-top: 1rem;">
                            <nav aria-label="User pagination">
                                <ul class="pagination" id="usersPagination" style="display: flex; list-style: none; gap: 0.5rem;">
                                    <!-- Pagination buttons will be populated by JS -->
                                </ul>
                            </nav>
                        </div>
                    </div>

                    <!-- KYC Verifications Section -->
                    <div id="kyc" class="admin-section" style="display: none;">
                        <h2>KYC Verifications</h2>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Submitted</th>
                                        <th>ID Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="kycTableBody">
                                     <tr><td colspan="5" style="text-align: center;">Loading KYC requests...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Manage Categories Section -->
                    <div id="categories" class="admin-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2>Manage Categories</h2>
                            <button class="btn btn-primary" onclick="openCategoryModal('create')"><i class="fas fa-plus"></i> Add New Category</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Icon</th>
                                        <th>Name</th>
                                        <th>Slug</th>
                                        <th>Services Count</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriesTableBody">
                                    <tr><td colspan="5" style="text-align: center;">Loading categories...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Manage Services (Gigs) Section -->
                    <div id="gigs" class="admin-section" style="display: none;">
                        <h2>Manage Services</h2>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <input type="text" id="gigsSearchInput" class="form-control" placeholder="Search services...">
                            <select id="gigsStatusFilter" class="form-control">
                                <option value="">All Statuses</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="paused">Paused</option>
                                <option value="deleted">Deleted</option>
                            </select>
                            <button class="btn btn-outline" onclick="filterGigs()"><i class="fas fa-filter"></i> Filter</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Service</th>
                                        <th>Seller</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="gigsTableBody">
                                    <tr><td colspan="7" style="text-align: center;">Loading services...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Manage Orders Section -->
                    <div id="orders" class="admin-section" style="display: none;">
                        <h2>Manage Orders</h2>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Service</th>
                                        <th>Buyer</th>
                                        <th>Seller</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <tr><td colspan="8" style="text-align: center;">Loading orders...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Withdrawal Requests Section -->
                    <div id="withdrawals" class="admin-section" style="display: none;">
                        <h2>Withdrawal Requests</h2>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Details</th>
                                        <th>Requested</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="withdrawalsTableBody">
                                    <tr><td colspan="7" style="text-align: center;">Loading withdrawal requests...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Manage Blog Section -->
                    <div id="blog" class="admin-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2>Manage Blog</h2>
                            <button class="btn btn-primary" onclick="openBlogPostModal('create')"><i class="fas fa-plus"></i> Add New Post</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Author</th>
                                        <th>Published</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="blogTableBody">
                                    <tr><td colspan="5" style="text-align: center;">Loading blog posts...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Live Messages Section -->
                    <div id="messages" class="admin-section" style="display: none;">
                        <h2>Live Messages</h2>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <input type="text" id="messagesSearchInput" class="form-control" placeholder="Search conversations...">
                            <button class="btn btn-outline"><i class="fas fa-search"></i> Search</button>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem;">
                            <div style="background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-md);">
                                <h3 style="margin-bottom: 1rem;">Conversations</h3>
                                <ul id="conversationsList" style="list-style: none; padding: 0;">
                                    <li style="padding: 0.5rem; border-bottom: 1px solid var(--border-color); cursor: pointer;">Loading conversations...</li>
                                </ul>
                            </div>
                            <div style="background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-md); display: flex; flex-direction: column;">
                                <div id="chatHeader" style="padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); margin-bottom: 1rem;">
                                    <h3 id="chatWithUserName">Select a conversation</h3>
                                </div>
                                <div id="chatMessages" style="flex-grow: 1; overflow-y: auto; padding: 1rem; background: var(--gray-50); border-radius: 0.5rem; margin-bottom: 1rem; height: 300px;">
                                    <p style="text-align: center; color: var(--gray-500);">No messages yet.</p>
                                </div>
                                <div id="chatInputArea" style="display: none;">
                                    <textarea id="chatMessageInput" class="form-control" placeholder="Type your message..." rows="3" style="margin-bottom: 0.5rem;"></textarea>
                                    <button class="btn btn-primary" onclick="sendMessage()" style="width: 100%;">Send Message</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Send Notifications Section -->
                    <div id="notifications" class="admin-section" style="display: none;">
                        <h2>Send Notifications & Emails</h2>
                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem;">Compose Notification</h3>
                            <form id="notificationForm">
                                <div class="form-group">
                                    <label for="notificationRecipient" class="form-label">Recipient(s) *</label>
                                    <select id="notificationRecipient" class="form-control" required>
                                        <option value="">Select Recipient Group</option>
                                        <option value="all">All Users</option>
                                        <option value="jobseekers">All Jobseekers</option>
                                        <option value="employers">All Employers</option>
                                        <option value="admins">All Admins</option>
                                        <option value="subscribers">Newsletter Subscribers</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="notificationSubject" class="form-label">Subject *</label>
                                    <input type="text" id="notificationSubject" class="form-control" placeholder="Notification Subject" required>
                                </div>
                                <div class="form-group">
                                    <label for="notificationMessage" class="form-label">Message *</label>
                                    <textarea id="notificationMessage" class="form-control" rows="5" placeholder="Your notification message..." required></textarea>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="sendAsEmailCheckbox" class="form-check-input">
                                    <label for="sendAsEmailCheckbox" class="form-check-label">Also send as email</label>
                                </div>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send Notification</button>
                            </form>
                        </div>
                    </div>

                    <!-- Platform Settings Section -->
                    <div id="settings" class="admin-section" style="display: none;">
                        <h2>Platform Settings</h2>
                        
                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem;">General Settings</h3>
                            <form id="generalSettingsForm">
                                <div class="form-group">
                                    <label for="platformName" class="form-label">Platform Name</label>
                                    <input type="text" id="platformName" class="form-control" placeholder="AtMyWorks">
                                </div>
                                <div class="form-group">
                                    <label for="platformDescription" class="form-label">Meta Description</label>
                                    <textarea id="platformDescription" class="form-control" rows="3" placeholder="Find the perfect freelance services for your business..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="platformKeywords" class="form-label">Meta Keywords</label>
                                    <input type="text" id="platformKeywords" class="form-control" placeholder="freelance, services, jobs, work">
                                    <div class="form-text">Separate keywords with commas.</div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save General Settings</button>
                            </form>
                        </div>

                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem;">Commission Settings</h3>
                            <form id="commissionSettingsForm">
                                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                                    <div class="form-group">
                                        <label for="commissionPercentage" class="form-label">Commission Percentage (%)</label>
                                        <input type="number" id="commissionPercentage" class="form-control" placeholder="10" min="0" max="100" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="fixedFee" class="form-label">Fixed Fee ($)</label>
                                        <input type="number" id="fixedFee" class="form-control" placeholder="2.50" min="0" step="0.01">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Commission Settings</button>
                            </form>
                        </div>

                        <div style="background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: var(--shadow-md);">
                            <h3 style="margin-bottom: 1rem;">Payment Methods</h3>
                            <form id="paymentMethodsForm">
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="enablePayPal" class="form-check-input">
                                    <label for="enablePayPal" class="form-check-label">Enable PayPal</label>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="enableStripe" class="form-check-input">
                                    <label for="enableStripe" class="form-check-label">Enable Stripe</label>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="enableGCash" class="form-check-input">
                                    <label for="enableGCash" class="form-check-label">Enable GCash</label>
                                </div>
                                <div class="form-check" style="margin-bottom: 1rem;">
                                    <input type="checkbox" id="enableMaya" class="form-check-input">
                                    <label for="enableMaya" class="form-check-label">Enable Maya</label>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Payment Methods</button>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- User Modal -->
    <div id="userModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; border-radius: 0.5rem; padding: 2rem; max-width: 600px; width: 90%;">
            <span class="close-modal" onclick="closeModals()" style="float: right; cursor: pointer; font-size: 1.5rem;">&times;</span>
            <h2 id="userModalTitle">User Details</h2>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label for="userEmail" class="form-label">Email</label>
                    <input type="email" id="userEmail" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="userRole" class="form-label">Role</label>
                    <select id="userRole" class="form-control">
                        <option value="jobseeker">Jobseeker</option>
                        <option value="employer">Employer</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="userStatus" class="form-label">Status</label>
                    <select id="userStatus" class="form-control">
                        <option value="active">Active</option>
                        <option value="suspended">Suspended</option>
                        <option value="banned">Banned</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Save User</button>
                <button type="button" class="btn btn-outline" onclick="closeModals()" style="margin-left: 0.5rem;">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; border-radius: 0.5rem; padding: 2rem; max-width: 600px; width: 90%;">
            <span class="close-modal" onclick="closeModals()" style="float: right; cursor: pointer; font-size: 1.5rem;">&times;</span>
            <h2 id="categoryModalTitle">Category Details</h2>
            <form id="categoryForm">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label for="categoryName" class="form-label">Name *</label>
                    <input type="text" id="categoryName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="categorySlug" class="form-label">Slug *</label>
                    <input type="text" id="categorySlug" class="form-control" required>
                    <div class="form-text">Used in URLs. Lowercase letters, numbers, and hyphens only.</div>
                </div>
                <div class="form-group">
                    <label for="categoryIcon" class="form-label">Icon Class (Font Awesome)</label>
                    <input type="text" id="categoryIcon" class="form-control" placeholder="fas fa-paint-brush">
                    <div class="form-text">e.g., fas fa-paint-brush, fab fa-wordpress</div>
                </div>
                <button type="submit" class="btn btn-primary">Save Category</button>
                <button type="button" class="btn btn-outline" onclick="closeModals()" style="margin-left: 0.5rem;">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Blog Post Modal -->
    <div id="blogPostModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: flex-start; padding-top: 2rem;">
        <div class="modal-content" style="background: white; border-radius: 0.5rem; padding: 2rem; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <span class="close-modal" onclick="closeModals()" style="float: right; cursor: pointer; font-size: 1.5rem;">&times;</span>
            <h2 id="blogPostModalTitle">Blog Post</h2>
            <form id="blogPostForm">
                <input type="hidden" id="postId">
                <div class="form-group">
                    <label for="postTitle" class="form-label">Title *</label>
                    <input type="text" id="postTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="postSlug" class="form-label">Slug *</label>
                    <input type="text" id="postSlug" class="form-control" required>
                    <div class="form-text">Used in URL. Lowercase letters, numbers, and hyphens only.</div>
                </div>
                <div class="form-group">
                    <label for="postExcerpt" class="form-label">Excerpt</label>
                    <textarea id="postExcerpt" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="postContent" class="form-label">Content *</label>
                    <!-- Create the editor container -->
                    <div id="postEditor" style="height: 300px;"></div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label for="postAuthor" class="form-label">Author *</label>
                        <input type="text" id="postAuthor" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="postStatus" class="form-label">Status *</label>
                        <select id="postStatus" class="form-control">
                            <option value="draft">Draft</option>
                            <option value="published">Published</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="postFeaturedImage" class="form-label">Featured Image</label>
                    <input type="file" id="postFeaturedImage" class="form-control" accept="image/*">
                    <div class="form-text">Recommended size: 1200x630px</div>
                    <img id="featuredImagePreview" src="" alt="Featured Image Preview" style="max-width: 200px; margin-top: 1rem; display: none;">
                </div>
                <button type="submit" class="btn btn-primary">Save Post</button>
                <button type="button" class="btn btn-outline" onclick="closeModals()" style="margin-left: 0.5rem;">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>AtMyWorks</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Press</a></li>
                        <li><a href="/blog.html">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Help & Support</a></li>
                        <li><a href="#">Trust & Safety</a></li>
                        <li><a href="#">Selling on AtMyWorks</a></li>
                        <li><a href="#">Buying on AtMyWorks</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                        <li><a href="#">Copyright Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 AtMyWorks. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Files -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.min.js"></script> <!-- Quill JS -->
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script> <!-- Dedicated admin JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log("Admin Dashboard DOM loaded");

             // Check if firebaseApp is available (from firebase-config.js)
            if (typeof window.firebaseApp !== 'undefined') {
                window.auth = window.firebaseApp.auth;
                window.db = window.firebaseApp.db;
                window.storage = window.firebaseApp.storage;
                console.log("Firebase services available in dashboard-admin.html");
            } else {
                console.warn("Firebase not initialized in dashboard-admin.html.");
                alert("Unable to connect to the database. Please try refreshing the page.");
                return;
            }

            // --- AUTHORIZATION CHECK ---
            checkAdminAuthorization();

            async function checkAdminAuthorization() {
                const user = window.auth.currentUser;
                if (!user) {
                    console.log("No user logged in, redirecting to admin login.");
                    alert("Please log in as an administrator.");
                    window.location.href = '/admin-login.html';
                    return;
                }

                try {
                    // Use the helper function from js/auth.js to check admin role
                    const isAdmin = await window.checkIfUserIsAdmin();
                    if (!isAdmin) {
                        console.log("User is not an admin, redirecting.");
                        alert("Access denied. Administrator privileges required.");
                        // Sign out the non-admin user
                        await window.auth.signOut();
                        window.location.href = '/admin-login.html';
                        return;
                    }

                    console.log("Admin authorization successful for user:", user.uid);
                    // If authorized, proceed with loading dashboard content
                    loadDashboardContent();

                } catch (error) {
                    console.error("Error during admin authorization check:", error);
                    alert("An error occurred during authorization. Please try logging in again.");
                    await window.auth.signOut();
                    window.location.href = '/admin-login.html';
                }
            }

            function loadDashboardContent() {
                console.log("Loading admin dashboard content...");
                // This is where you would call functions to load stats, users, etc.
                // For example:
                // loadDashboardStats();
                // loadPendingWithdrawals();
                // loadRecentActivity();
                
                // Initialize any other components or features
                if (typeof window.initAdminDashboard === 'function') {
                    window.initAdminDashboard();
                } else {
                    console.warn("initAdminDashboard function not found. Is dashboard.js loaded correctly?");
                }
            }

            // --- ADMIN NAVIGATION LOGIC ---
            const navLinks = document.querySelectorAll('.admin-nav-link');
            if (navLinks.length > 0) {
                navLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const targetSectionId = this.getAttribute('data-section');
                        switchSection(targetSectionId);
                    });
                });
            }

            // --- MODAL LOGIC ---
            // Close modals if clicked outside
            window.onclick = function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        closeModals();
                    }
                });
            }

            // --- FORM SUBMISSIONS ---
            // Notification Form
            const notificationForm = document.getElementById('notificationForm');
            if (notificationForm) {
                notificationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Notification form submitted");
                    alert("Notification sending logic would be implemented here.");
                    // In a real app, you would collect form data and send it to your backend
                    // or a Firebase Function to handle sending emails/notifications.
                });
            }

            // General Settings Form
            const generalSettingsForm = document.getElementById('generalSettingsForm');
            if (generalSettingsForm) {
                generalSettingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("General settings form submitted");
                    alert("General settings saving logic would be implemented here.");
                });
            }

            // Commission Settings Form
            const commissionSettingsForm = document.getElementById('commissionSettingsForm');
            if (commissionSettingsForm) {
                commissionSettingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Commission settings form submitted");
                    alert("Commission settings saving logic would be implemented here.");
                });
            }

            // Payment Methods Form
            const paymentMethodsForm = document.getElementById('paymentMethodsForm');
            if (paymentMethodsForm) {
                paymentMethodsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Payment methods form submitted");
                    alert("Payment methods saving logic would be implemented here.");
                });
            }

            // User Form
            const userForm = document.getElementById('userForm');
            if (userForm) {
                userForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("User form submitted");
                    alert("User saving logic would be implemented here.");
                });
            }

            // Category Form
            const categoryForm = document.getElementById('categoryForm');
            if (categoryForm) {
                categoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Category form submitted");
                    alert("Category saving logic would be implemented here.");
                });
            }

            // Blog Post Form
            const blogPostForm = document.getElementById('blogPostForm');
            if (blogPostForm) {
                blogPostForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log("Blog post form submitted");
                    alert("Blog post saving logic would be implemented here.");
                });
            }
            // --- END FORM SUBMISSIONS ---
        });

        // Function to switch between admin sections
        function switchSection(sectionId) {
            console.log("Switching to section:", sectionId);
            // Hide all sections
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => {
                section.style.display = 'none';
                section.classList.remove('active');
            });

            // Show the target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                targetSection.classList.add('active');
            }

            // Update active nav link
            const navLinks = document.querySelectorAll('.admin-nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === sectionId) {
                    link.classList.add('active');
                }
            });

            // Load data for the section if needed
            if (typeof window.loadAdminSectionData === 'function') {
                window.loadAdminSectionData(sectionId);
            } else {
                console.warn(`loadAdminSectionData function not found for section ${sectionId}`);
            }
        }

        // Function to open User Modal
        function openUserModal(action, userData = null) {
            const modal = document.getElementById('userModal');
            const title = document.getElementById('userModalTitle');
            const form = document.getElementById('userForm');
            const userIdInput = document.getElementById('userId');
            const emailInput = document.getElementById('userEmail');
            const roleSelect = document.getElementById('userRole');
            const statusSelect = document.getElementById('userStatus');

            if (action === 'create') {
                title.textContent = 'Create New User';
                userIdInput.value = '';
                emailInput.value = '';
                emailInput.readOnly = false;
                roleSelect.value = 'jobseeker';
                statusSelect.value = 'active';
                // Clear other fields if any
            } else if (action === 'edit' && userData) {
                title.textContent = `Edit User: ${userData.email}`;
                userIdInput.value = userData.id;
                emailInput.value = userData.email;
                emailInput.readOnly = true; // Usually don't allow email change
                roleSelect.value = userData.role || 'jobseeker';
                statusSelect.value = userData.status || 'active';
                // Populate other fields if any
            }

            if (modal) {
                modal.style.display = 'flex';
            }
        }

        // Function to open Category Modal
        function openCategoryModal(action, categoryData = null) {
            const modal = document.getElementById('categoryModal');
            const title = document.getElementById('categoryModalTitle');
            const form = document.getElementById('categoryForm');
            const categoryIdInput = document.getElementById('categoryId');
            const nameInput = document.getElementById('categoryName');
            const slugInput = document.getElementById('categorySlug');
            const iconInput = document.getElementById('categoryIcon');

            if (action === 'create') {
                title.textContent = 'Create New Category';
                categoryIdInput.value = '';
                nameInput.value = '';
                slugInput.value = '';
                iconInput.value = '';
            } else if (action === 'edit' && categoryData) {
                title.textContent = `Edit Category: ${categoryData.name}`;
                categoryIdInput.value = categoryData.id;
                nameInput.value = categoryData.name;
                slugInput.value = categoryData.slug;
                iconInput.value = categoryData.icon || '';
            }

            if (modal) {
                modal.style.display = 'flex';
            }
        }

        // Function to open Blog Post Modal
        function openBlogPostModal(action, postData = null) {
            const modal = document.getElementById('blogPostModal');
            const title = document.getElementById('blogPostModalTitle');
            const form = document.getElementById('blogPostForm');
            const postIdInput = document.getElementById('postId');
            const titleInput = document.getElementById('postTitle');
            const slugInput = document.getElementById('postSlug');
            const excerptInput = document.getElementById('postExcerpt');
            const authorInput = document.getElementById('postAuthor');
            const statusSelect = document.getElementById('postStatus');
            const featuredImageInput = document.getElementById('postFeaturedImage');
            const imagePreview = document.getElementById('featuredImagePreview');

            // Initialize Quill editor if not already done
            if (!window.quillEditor) {
                window.quillEditor = new Quill('#postEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });
            }

            if (action === 'create') {
                title.textContent = 'Create New Blog Post';
                postIdInput.value = '';
                titleInput.value = '';
                slugInput.value = '';
                excerptInput.value = '';
                window.quillEditor.setContents([]); // Clear editor
                authorInput.value = ''; // Could default to current admin
                statusSelect.value = 'draft';
                featuredImageInput.value = ''; // Clear file input
                imagePreview.style.display = 'none';
                imagePreview.src = '';
            } else if (action === 'edit' && postData) {
                title.textContent = `Edit Blog Post: ${postData.title}`;
                postIdInput.value = postData.id;
                titleInput.value = postData.title;
                slugInput.value = postData.slug;
                excerptInput.value = postData.excerpt || '';
                // Set editor content (Quill expects Delta format or HTML string)
                // This is a simplification, you might need to convert from your data format
                window.quillEditor.root.innerHTML = postData.content || '';
                authorInput.value = postData.author || '';
                statusSelect.value = postData.status || 'draft';
                // Handle image preview if URL exists
                if (postData.featuredImageUrl) {
                    imagePreview.src = postData.featuredImageUrl;
                    imagePreview.style.display = 'block';
                } else {
                    imagePreview.style.display = 'none';
                    imagePreview.src = '';
                }
            }

            if (modal) {
                modal.style.display = 'flex';
            }
        }

        // Function to close all modals
        function closeModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // Function placeholder for sending messages (Live Messages section)
        function sendMessage() {
            const messageInput = document.getElementById('chatMessageInput');
            const message = messageInput.value.trim();
            if (message) {
                console.log("Sending message:", message);
                alert("Message sending logic would be implemented here.");
                messageInput.value = '';
            }
        }
    </script>
</body>
</html>